{% load static %}
<!DOCTYPE html>
<html lang="ja">
    <head>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <title>ScrimPay Main page</title>
        <link rel="stylesheet" href="{% static 'css/main.css' %}">
        <link href="https://fonts.googleapis.com/css?family=Calistoga|Noto+Sans+JP&display=swap" rel="stylesheet">
        <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.8.2/css/all.css" integrity="sha384-oS3vJWv+0UjzBfQzYUhtDYW+Pj2yciDJxpsK1OYPAYjqT085Qq/1cq5FLXAZQ7Ay" crossorigin="anonymous">
      </head>
  
  <script src="https://unpkg.com/vue@2.5.17"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.7.1/Chart.min.js"></script>
  <script src="https://unpkg.com/vue-chartjs/dist/vue-chartjs.min.js"></script>


  <body class="center">
    <header class="strheader">
        <div class="headerinner">
            <div class="header01">
                <div class="header_name">Scrim<span class="header_subname">Pay</span></div>
            </div>
            <div>
                <nav class="navi01">
                    <ul class="foo">
                        <li class="inline-item"><a class="menu" href="">HOME</a></li>
                        <li class="inline-item"><a class="menu" href="{% url 'scrimpay:search' %}">SEARCH</a></li>
                        <li class="inline-item"><a class="menu" href="">HELP</a></li>
                    </ul>
                </nav>
            </div>
        </div>
    </header>

    <div class="main">
        <div class="explain">
            Monthly Subscription
        </div>

        <div id="app" class="chart_price">
            <doughnut-chart></doughnut-chart>
            <canvas id="chartPrice" width="300" height="45"></canvas>
            <p>
                ¥{{fee_sum}}
            </p>
        </div>

        <div>
            {% for i in val3 %}
                {% for j in val%}
                    {% if i.service_id == j.service_id %}
                    <div class="tab">
                        <input id={{i.service_name}} type="checkbox" name="tabs">
                        <label for={{i.service_name}}>{{i.service_name}}</label>
                        <div class="tab-content">
                            <p>{{i.plan_name}}</p>
                            <p>{{i.fee_per_month}}円</p>
                        </div>
                    </div>        
                    {% endif %}
                {% endfor %}
        {% endfor %}
        </div>
    </div>

    <footer class="footer01">
        <div class="footer02">
          <div class="footer03">
            <div class="btn-border">
                <form action = "{% url 'scrimpay:index' %}">
                    <button class="cp_btn" id="button" name="button">Add Service</button>
                </form>
                <form action = "{% url 'scrimpay:deletedb' %}">
                    <button class="cp_btn" id="button" name="button">Delete Service</button>
                </form>
            </div>
          </div>
        </div>
      </footer>

    </body>

</html>

<script>

var aaa = '{{array}}';
aaa = aaa.replace(/&#x27;/g,"");
aaa = aaa.replace(/, /g,",");
aaa = aaa.replace("[","");
aaa = aaa.replace("]","");
ary = aaa.split(',');

var aaa = '{{color_array}}';
aaa = aaa.replace(/&#x27;/g,"");
aaa = aaa.replace(/, /g,",");
aaa = aaa.replace("[","");
aaa = aaa.replace("]","");
color_ary = aaa.split(',');

var aaa = '{{rate_array}}';
aaa = aaa.replace(/&#x27;/g,"");
aaa = aaa.replace(/, /g,",");
aaa = aaa.replace("[","");
aaa = aaa.replace("]","");
rate_ary = aaa.split(',');


Vue.component('doughnut-chart', {
    extends: VueChartJs.Doughnut,
    mounted(){
        this.renderChart({
            labels: ary,
            datasets:[
                {
                    backgroundColor: color_ary,
                    data:rate_ary
                }
            ],
        }, {
            responsive: true, 
            maintainAspectRatio: false
        })
    }
})

var vm = new Vue({
    el: '#app',
})
</script>